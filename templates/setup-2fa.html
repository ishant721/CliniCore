
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0" />
    <title>HealthStack - Two-Factor Authentication</title>

    <!-- Favicons -->
    <link type="image/x-icon" href="{% static 'HealthStack-System/images/Normal/favicon.png' %}" rel="icon" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/bootstrap.min.css' %}" />

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="{% static 'HealthStack-System/plugins/Normal/fontawesome/css/fontawesome.min.css' %}" />
    <link rel="stylesheet" href="{% static 'HealthStack-System/plugins/Normal/fontawesome/css/all.min.css' %}" />

    <!-- Main CSS -->
    <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/style.css' %}" />
</head>
<body>
    <!-- Main Wrapper -->
    <div class="main-wrapper">
        
        <!-- Header -->
        <header class="header">
            {% include 'patient_navbar.html' %}
        </header>
        <!-- /Header -->
        
        <!-- Breadcrumb -->
        <div class="breadcrumb-bar">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-12 col-12">
                        <nav aria-label="breadcrumb" class="page-breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="{% url 'patient-dashboard' %}">Home</a></li>
                                <li class="breadcrumb-item"><a href="{% url 'profile-settings' %}">Profile</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Two-Factor Authentication</li>
                            </ol>
                        </nav>
                        <h2 class="breadcrumb-title">Two-Factor Authentication</h2>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Breadcrumb -->
        
        <!-- Page Content -->
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-5 col-lg-4 col-xl-3 theiaStickySidebar">
                        {% include 'patient-sidebar.html' %}
                    </div>
                    
                    <div class="col-md-7 col-lg-8 col-xl-9">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12 col-lg-9">
                                        
                                        {% include 'message.html' %}
                                        
                                        <div class="card">
                                            <div class="card-header">
                                                <h4 class="card-title">Two-Factor Authentication (2FA)</h4>
                                            </div>
                                            <div class="card-body">
                                                {% if not action_completed %}
                                                    {% if not two_factor_enabled %}
                                                        <div class="alert alert-info">
                                                            <i class="fas fa-info-circle"></i>
                                                            <strong>Enhance your account security!</strong><br>
                                                            Two-factor authentication adds an extra layer of security to your account by requiring a verification code sent to your email in addition to your password.
                                                        </div>
                                                        
                                                        <div class="mb-4">
                                                            <h5>Benefits of 2FA:</h5>
                                                            <ul>
                                                                <li>Protects your account even if your password is compromised</li>
                                                                <li>Prevents unauthorized access to your medical records</li>
                                                                <li>Industry-standard security practice</li>
                                                                <li>Peace of mind for your personal health information</li>
                                                            </ul>
                                                        </div>
                                                        
                                                        <form method="POST">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="action" value="enable">
                                                            <button type="submit" class="btn btn-primary">
                                                                <i class="fas fa-shield-alt"></i> Enable Two-Factor Authentication
                                                            </button>
                                                        </form>
                                                    {% else %}
                                                        <div class="alert alert-success">
                                                            <i class="fas fa-check-circle"></i>
                                                            <strong>Two-factor authentication is enabled</strong><br>
                                                            Your account is protected with an additional layer of security.
                                                        </div>
                                                        
                                                        <div class="mb-4">
                                                            <h5>2FA Status: <span class="badge badge-success">Active</span></h5>
                                                            <p>When you log in, you'll receive a verification code via email that you'll need to enter along with your password.</p>
                                                        </div>
                                                        
                                                        <form method="POST">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="action" value="disable">
                                                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to disable two-factor authentication?')">
                                                                <i class="fas fa-times-circle"></i> Disable Two-Factor Authentication
                                                            </button>
                                                        </form>
                                                    {% endif %}
                                                {% else %}
                                                    <div class="alert alert-success">
                                                        <i class="fas fa-check-circle"></i>
                                                        <strong>Two-factor authentication enabled successfully!</strong>
                                                    </div>
                                                    
                                                    {% if backup_codes %}
                                                        <div class="alert alert-warning">
                                                            <i class="fas fa-exclamation-triangle"></i>
                                                            <strong>Important: Save your backup codes</strong><br>
                                                            These backup codes can be used to access your account if you can't receive your 2FA code. Store them in a safe place.
                                                        </div>
                                                        
                                                        <div class="card">
                                                            <div class="card-header">
                                                                <h5>Your Backup Codes</h5>
                                                            </div>
                                                            <div class="card-body">
                                                                <div class="row">
                                                                    {% for code in backup_codes %}
                                                                        <div class="col-md-6 mb-2">
                                                                            <code class="backup-code">{{ code }}</code>
                                                                        </div>
                                                                    {% endfor %}
                                                                </div>
                                                                <hr>
                                                                <small class="text-muted">
                                                                    <i class="fas fa-info-circle"></i>
                                                                    Each backup code can only be used once. Print this page or copy these codes to a secure location.
                                                                </small>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                    
                                                    <div class="mt-3">
                                                        <a href="{% url 'profile-settings' %}" class="btn btn-success">
                                                            <i class="fas fa-check"></i> Continue to Profile
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Page Content -->
        
        <!-- Footer -->
        {% include 'footer.html' %}
        <!-- /Footer -->
        
    </div>
    <!-- /Main Wrapper -->
    
    <!-- jQuery -->
    <script src="{% static 'HealthStack-System/js/Normal/jquery.min.js' %}"></script>
    
    <!-- Bootstrap Core JS -->
    <script src="{% static 'HealthStack-System/js/Normal/popper.min.js' %}"></script>
    <script src="{% static 'HealthStack-System/js/Normal/bootstrap.min.js' %}"></script>
    
    <!-- Sticky Sidebar JS -->
    <script src="{% static 'HealthStack-System/plugins/Normal/theia-sticky-sidebar/ResizeSensor.js' %}"></script>
    <script src="{% static 'HealthStack-System/plugins/Normal/theia-sticky-sidebar/theia-sticky-sidebar.js' %}"></script>
    
    <!-- Custom JS -->
    <script src="{% static 'HealthStack-System/Outside_assets/js/script.js' %}"></script>

    <style>
        .backup-code {
            display: block;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid #dee2e6;
        }
    </style>
    
</body>
</html>
